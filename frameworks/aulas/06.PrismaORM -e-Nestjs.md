---
marp: true
theme: default
paginate: true
class: lead
---

# ğŸ§© Aula: PrismaJS + NestJS + SQLite  
### Criando uma API moderna e tipada com ORM

---

## ğŸ¯ Objetivos da Aula

- Entender o que Ã© o **Prisma ORM**  
- Aprender a instalar e configurar o **Prisma** em um projeto **NestJS**  
- Utilizar o **SQLite** como banco de dados local  
- Criar modelos, migrar o banco e usar o Prisma Client  
- Integrar o Prisma a um mÃ³dulo do NestJS  

---

## ğŸ§  O que Ã© o Prisma?

O **Prisma** Ã© um ORM (Object Relational Mapper) moderno para **Node.js** e **TypeScript**.

Ele substitui ORMs tradicionais (como TypeORM e Sequelize) oferecendo:

- **Autocompletar** e **tipagem forte** (Typescript)
- **Gerador de cliente automÃ¡tico**
- **MigraÃ§Ãµes** simples e seguras
- **Suporte a vÃ¡rios bancos** (Postgres, MySQL, SQLite, etc.)

---

## âš™ï¸ Arquitetura Geral

```plaintext
NestJS (Controllers, Services)
       â†“
   Prisma Service
       â†“
   Prisma Client
       â†“
   Banco de Dados (SQLite)
````

---

## ğŸ§° Passo 1 â€” Criar o Projeto NestJS

```bash
npm i -g @nestjs/cli
nest new api-prisma
cd api-prisma
```

Escolha **npm** ou **yarn** conforme sua preferÃªncia.

---

## ğŸª„ Passo 2 â€” Instalar o Prisma

```bash
npm install prisma --save-dev
npm install @prisma/client
```

Inicializar o Prisma:

```bash
npx prisma init
```

Isso cria a pasta **`prisma/`** com o arquivo **`schema.prisma`** e adiciona o `.env`.

---

## ğŸ’¾ Passo 3 â€” Configurar o Banco de Dados (SQLite)

No arquivo `.env`:

```bash
DATABASE_URL="file:./dev.db"
```

No `prisma/schema.prisma`:

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}
```

---

## ğŸ§± Passo 4 â€” Criar um Modelo

Vamos criar uma tabela de usuÃ¡rios:

```prisma
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
}
```

---

## ğŸš€ Passo 5 â€” Gerar o Banco e o Cliente

Rodar as migraÃ§Ãµes:

```bash
npx prisma migrate dev --name init
```

Verifique o banco com:

```bash
npx prisma studio
```

(Abre uma interface web de visualizaÃ§Ã£o dos dados)

---

## ğŸ§© Passo 6 â€” Criar o PrismaModule no NestJS

Crie o arquivo:
ğŸ“ `src/prisma/prisma.module.ts`

```ts
import { Global, Module } from '@nestjs/common';
import { PrismaService } from './prisma.service';

@Global()
@Module({
  providers: [PrismaService],
  exports: [PrismaService],
})
export class PrismaModule {}
```

---

## âš™ï¸ PrismaService

Crie o arquivo:
ğŸ“ `src/prisma/prisma.service.ts`

```ts
import { Injectable, OnModuleInit, OnModuleDestroy } from '@nestjs/common';
import { PrismaClient } from '@prisma/client';

@Injectable()
export class PrismaService extends PrismaClient
  implements OnModuleInit, OnModuleDestroy {
  async onModuleInit() {
    await this.$connect();
  }

  async onModuleDestroy() {
    await this.$disconnect();
  }
}
```

---

## ğŸ§ª Passo 7 â€” Criar o MÃ³dulo de UsuÃ¡rios

```bash
nest g module users
nest g service users
nest g controller users
```

---

## ğŸ“¦ UserService com Prisma

ğŸ“ `src/users/users.service.ts`

---

```ts
import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma/prisma.service';
import { User } from '@prisma/client';

@Injectable()
export class UsersService {
  constructor(private prisma: PrismaService) {}

  async create(name: string, email: string): Promise<User> {
    return this.prisma.user.create({
      data: { name, email },
    });
  }

  async findAll(): Promise<User[]> {
    return this.prisma.user.findMany();
  }
}
```

---

## ğŸ§­ UsersController

ğŸ“ `src/users/users.controller.ts`

---

```ts
import { Controller, Get, Post, Body } from '@nestjs/common';
import { UsersService } from './users.service';

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get()
  findAll() {
    return this.usersService.findAll();
  }

  @Post()
  create(@Body() body: { name: string; email: string }) {
    return this.usersService.create(body.name, body.email);
  }
}
```

---

## ğŸ§© Passo 8 â€” Registrar o PrismaModule

ğŸ“ `src/app.module.ts`

```ts
import { Module } from '@nestjs/common';
import { UsersModule } from './users/users.module';
import { PrismaModule } from './prisma/prisma.module';

@Module({
  imports: [PrismaModule, UsersModule],
})
export class AppModule {}
```

---

## ğŸ§  Testando a API

Rodar o servidor:

```bash
npm run start:dev
```

### Endpoints:

* `GET /users` â†’ lista usuÃ¡rios
* `POST /users` â†’ cria usuÃ¡rio

Exemplo de corpo JSON:

```json
{
  "name": "Alice",
  "email": "alice@email.com"
}
```

---

## ğŸ“Š Resultado Esperado

```
POST /users
â†’ { id: 1, name: "Alice", email: "...", createdAt: "..." }

GET /users
â†’ [ { id: 1, name: "Alice", ... } ]
```

---

## âœ… Recapitulando

1. Criamos um projeto **NestJS**
2. Instalamos e configuramos o **Prisma ORM**
3. Usamos **SQLite** como banco
4. Criamos modelos e migramos o banco
5. Implementamos **PrismaService**
6. Fizemos **CRUD bÃ¡sico** no mÃ³dulo de usuÃ¡rios

---

## ğŸ§  Dica Extra: Prisma Studio

Para visualizar o banco:

```bash
npx prisma studio
```

Interface web incrÃ­vel para editar e visualizar dados.

---

## ğŸ ConclusÃ£o

O **Prisma** simplifica o acesso ao banco, garantindo **tipagem**, **produtividade** e **seguranÃ§a**.
Com o **NestJS**, formamos uma combinaÃ§Ã£o poderosa para **APIs modernas e escalÃ¡veis** ğŸš€

---

## ğŸ“š ReferÃªncias

* [Prisma Docs](https://www.prisma.io/docs)
* [NestJS Docs](https://docs.nestjs.com/)
* [SQLite Docs](https://www.sqlite.org/docs.html)

