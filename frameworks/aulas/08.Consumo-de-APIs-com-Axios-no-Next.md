---
marp: true
theme: default
size: 16:9
paginate: true

---

# üöÄ Dominando o Consumo de APIs com Axios no Next.js

Uma aula detalhada sobre Client-Side, Server-Side e Melhores Pr√°ticas.

---

## üìã Agenda da Aula

1.  **Configura√ß√£o:** Instalando o Axios.
2.  **CSR (Client-Side Rendering):** O padr√£o React com `useEffect`.
3.  **SSR (Server-Side Rendering):** Buscando dados a cada request com `getServerSideProps`.
4.  **SSG (Static Site Generation):** Buscando dados no *build* com `getStaticProps`.
5.  **Melhores Pr√°ticas (1):** Criando uma inst√¢ncia do Axios.
6.  **Melhores Pr√°ticas (2):** Usando API Routes para proteger chaves (BFF).
7.  **Resumo Comparativo:** Quando usar cada m√©todo.

---

## ‚öôÔ∏è Configura√ß√£o Inicial

Antes de come√ßar, voc√™ precisa de:
* Conhecimento b√°sico de React (Hooks) e Next.js.
* Um projeto Next.js iniciado (`npx create-next-app`).

**Instalando o Axios:**
Abra seu terminal e rode o comando:

```bash
npm install axios
# ou
yarn add axios
````

-----

## 1\. Client-Side Rendering (CSR)

Este √© o m√©todo padr√£o do React. A p√°gina √© carregada e, **no navegador**, o JavaScript busca os dados.

  * **Quando usar:** Dados espec√≠ficos do usu√°rio (dashboards), dados que mudam com frequ√™ncia, dados n√£o essenciais para a primeira carga.
  * **Pr√≥s:** R√°pida carga inicial da p√°gina (UI).
  * **Contras:** O usu√°rio v√™ um "loading". Ruim para SEO, pois os dados n√£o est√£o no HTML inicial.

-----

### CSR: Exemplo com `useEffect`

Os dados s√£o buscados no cliente usando `useEffect` e `useState`.

**`pages/produtos-csr.js`**
---

```jsx
import { useState, useEffect } from 'react';
import axios from 'axios';

export default function ProdutosCSR() {
  const [produtos, setProdutos] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchProdutos = async () => {
      try {
        setLoading(true);
        const res = await axios.get('[https://dummyjson.com/products?limit=10](https://dummyjson.com/products?limit=10)');
        setProdutos(res.data.products);
      } catch (err) {
        console.error(err);
      } finally {
        setLoading(false);
      }
    };
    fetchProdutos();
  }, []); // Array vazio: roda 1x no cliente
```
---

```jsx
  if (loading) return <p>Carregando...</p>;

  return (
    <div>
      <h1>Nossos Produtos (CSR)</h1>
      <ul>
        {produtos.map((p) => <li key={p.id}>{p.title}</li>)}
      </ul>
    </div>
  );
}
```

-----

## 2\. Server-Side Rendering (SSR)

O Next.js executa a busca de dados **no servidor** a **cada nova requisi√ß√£o**. A p√°gina √© enviada ao cliente j√° completa.

  * **Fun√ß√£o:** `getServerSideProps`
  * **Quando usar:** Dados que mudam a todo instante e precisam de SEO (ex: p√°ginas de busca, cota√ß√£o de moedas, perfis de usu√°rio).
  * **Pr√≥s:** √ìtimo para SEO. Dados sempre 100% atualizados.
  * **Contras:** Mais lento que SSG, pois o servidor *sempre* espera a API responder.

-----

### SSR: Exemplo com `getServerSideProps`

Dividimos o arquivo em duas partes: o componente e a fun√ß√£o de *data fetching*.

**`pages/produtos-ssr.js`**

---

```jsx
import axios from 'axios';

// 1. O Componente (recebe 'props' do servidor)
export default function ProdutosSSR({ produtos }) {
  return (
    <div>
      <h1>Nossos Produtos (SSR)</h1>
      <ul>
        {produtos.map((p) => <li key={p.id}>{p.title}</li>)}
      </ul>
    </div>
  );
}

// 2. A Fun√ß√£o (Roda NO SERVIDOR a cada request)
export async function getServerSideProps() {
  try {
    const response = await axios.get('[https://dummyjson.com/products?limit=10](https://dummyjson.com/products?limit=10)');
    
    return {
      props: { // Os dados s√£o injetados em 'props'
        produtos: response.data.products,
      },
    };
  } catch (err) {
    return { props: { produtos: [] } };
  }
}
```

-----

## 3\. Static Site Generation (SSG)

O Next.js executa a busca **no servidor** apenas **uma vez, em tempo de *build***. Ele gera um HTML est√°tico.

  * **Fun√ß√£o:** `getStaticProps`
  * **Quando usar:** Dados que mudam raramente (posts de blog, p√°ginas de marketing, documenta√ß√£o).
  * **Pr√≥s:** Performance imbat√≠vel (servido de CDN). √ìtimo para SEO.
  * **Contras:** Dados ficam "congelados" at√© o pr√≥ximo *build*. (Pode ser resolvido com **ISR**).

> **ISR (Incremental Static Regeneration):** Use `revalidate: 60` em `getStaticProps` para regerar a p√°gina a cada 60 segundos.

-----

### SSG: Exemplo com `getStaticProps`

A estrutura √© quase id√™ntica ao SSR, mas a fun√ß√£o tem um nome diferente.

**`pages/produtos-ssg.js`**

---

```jsx
import axios from 'axios';

// 1. O Componente (igual ao SSR)
export default function ProdutosSSG({ produtos }) {
  return (
    <div>
      <h1>Nossos Produtos (SSG)</h1>
      <ul>
        {produtos.map((p) => <li key={p.id}>{p.title}</li>)}
      </ul>
    </div>
  );
}

// 2. A Fun√ß√£o (Roda NO SERVIDOR apenas 1x no build)
export async function getStaticProps() {
  try {
    const response = await axios.get('[https://dummyjson.com/products?limit=10](https://dummyjson.com/products?limit=10)');
    
    return {
      props: {
        produtos: response.data.products,
      },
      // revalidate: 60, // Opcional: Ativa o ISR
    };
  } catch (err) {
    return { props: { produtos: [] } };
  }
}
```

-----

## 4\. üèÜ Melhor Pr√°tica 1: Inst√¢ncia do Axios

N√£o repita sua `baseURL` e *headers* em todo lugar. Crie um servi√ßo centralizado.

**1. Crie `lib/api.js`**

---

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: '[https://dummyjson.com](https://dummyjson.com)',
  // headers: { 'Authorization': 'Bearer SEU_TOKEN_AQUI' }
});

export default api;
```

**2. Use a inst√¢ncia nas suas p√°ginas**

```jsx
// Em getServerSideProps ou getStaticProps
import api from '../lib/api'; // Nossa inst√¢ncia!

export async function getServerSideProps() {
  // Usamos 'api' e apenas o path relativo
  const response = await api.get('/products?limit=10');
  
  return {
    props: { produtos: response.data.products }
  };
}
```

-----

## 5\. üèÜ Melhor Pr√°tica 2: API Routes (BFF)

**Problema:** E se a API precisa de uma **chave secreta (API Key)**?
Voc√™ **NUNCA** deve expor chaves secretas no Client-Side (CSR).

**Solu√ß√£o:** Use as API Routes do Next.js como um *Backend-for-Frontend* (BFF).

**Fluxo:**
Seu Cliente (CSR) ‚Üí **Sua API Route (`/api/...`)** ‚Üí API Externa (com Axios)

O Axios roda no seu servidor, protegendo a chave.

-----

### API Routes: Exemplo (BFF)

**1. Crie a API Route (Servidor)**
**`pages/api/produtos.js`**

---

```javascript
// Este c√≥digo S√ì roda no servidor
import axios from 'axios';

export default async function handler(req, res) {
  if (req.method !== 'GET') {
    return res.status(405).end();
  }
  
  try {
    const response = await axios.get('[https://dummyjson.com/products](https://dummyjson.com/products)', {
      params: req.query, // Repassa query params (ex: ?limit=5)
      // headers: { 'Authorization': `Bearer ${process.env.API_SECRET_KEY}` }
    });
    res.status(200).json(response.data);
  } catch (error) {
    res.status(500).json({ message: 'Erro ao buscar dados' });
  }
}
```

-----

### API Routes: Exemplo (BFF)

**2. Consuma sua pr√≥pria API (Cliente)**
Agora, seu componente CSR chama a sua API interna, que √© segura.

**`pages/produtos-csr.js` (Modificado)**

---

```jsx
import { useState, useEffect } from 'react';
import axios from 'axios';

export default function ProdutosCSR() {
  const [produtos, setProdutos] = useState([]);

  useEffect(() => {
    const fetchProdutos = async () => {
      try {
        // ATEN√á√ÉO: Chamando a NOSSA API interna!
        const res = await axios.get('/api/produtos?limit=10'); 
        setProdutos(res.data.products);
      } catch (err) {
        console.error(err);
      }
    };
    fetchProdutos();
  }, []);

  // ... render ...
}
```

-----

## üìä Resumo Comparativo

---

| M√©todo | Fun√ß√£o Next.js | Onde o Axios Roda? | Quando Roda? | SEO | Velocidade |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **CSR** | `useEffect` | **Navegador** | Ap√≥s carregar a p√°g. | Ruim | R√°pido (UI) |
| **SSR** | `getServerSideProps`| **Servidor** | A cada requisi√ß√£o | √ìtimo | Lento |
| **SSG** | `getStaticProps` | **Servidor** | Em tempo de *build* | Perfeito | Instant√¢neo |
| **API Route** | `pages/api/*` | **Servidor** | Sob demanda | N/A | N/A |

-----

## ‚úÖ Conclus√£o

  * **CSR (`useEffect`):** Para dados do usu√°rio, n√£o-cr√≠ticos.
  * **SSR (`getServerSideProps`):** Para dados din√¢micos e SEO.
  * **SSG (`getStaticProps`):** Para dados est√°ticos e SEO (a op√ß√£o mais r√°pida).
  * **API Routes:** Para proteger suas chaves de API e criar um *proxy* (BFF).

**Obrigado\!**

```
```