---
marp: true
size: 16:9
paginate: true
---

# Persist√™ncia de Dados no Navegador

### Local Storage, Session Storage e IndexedDB

---

## Objetivos da Aula

* **Compreender** o que √© a persist√™ncia de dados no navegador.
* **Diferenciar** Local Storage, Session Storage e IndexedDB.
* **Aprender** a utilizar a API de cada tecnologia com exemplos pr√°ticos.
* **Identificar** os melhores cen√°rios para aplica√ß√£o de cada tipo de armazenamento.

---

## Por que Armazenar Dados no Navegador?

Antigamente, us√°vamos **cookies**, mas eles tinham limita√ß√µes:
* **Baixo limite:** Apenas ~4KB.
* **Sobrecarga de Rede:** Enviados em toda requisi√ß√£o HTTP.

As APIs modernas oferecem mais capacidade, flexibilidade e seguran√ßa.

**Casos de Uso Comuns:**
* Manter um usu√°rio logado ("Lembrar de mim").
* Salvar prefer√™ncias do usu√°rio (ex: tema escuro).
* Armazenar um carrinho de compras.
* Habilitar aplica√ß√µes offline (PWAs).

---

## **Web Storage API**

### Local Storage & Session Storage

---

## `localStorage`

O **`localStorage`** armazena dados que persistem mesmo ap√≥s o navegador ser fechado.

* **Persist√™ncia:** Longa dura√ß√£o.
* **Escopo:** Compartilhado entre abas da mesma origem.
* **Capacidade:** ~5-10MB.
* **Dados:** Apenas `strings`. (Use `JSON.stringify` e `JSON.parse` para objetos).
* **API:** **S√≠ncrona** (pode bloquear a interface).

**Ideal para:** Prefer√™ncias do usu√°rio, tokens de autentica√ß√£o persistentes.

---

## `localStorage`: Exemplos de C√≥digo

```javascript
// Salvar um item
localStorage.setItem('tema', 'escuro');

// Salvar um objeto (convertido para string)
const usuario = { nome: 'Maria', nivel: 5 };
localStorage.setItem('dadosUsuario', JSON.stringify(usuario));

// Ler um item
const temaSalvo = localStorage.getItem('tema'); // "escuro"

// Ler um objeto (convertido de volta)
const usuarioObj = JSON.parse(localStorage.getItem('dadosUsuario'));

// Remover um item
localStorage.removeItem('tema');

// Limpar tudo
localStorage.clear();
````

-----

## `sessionStorage`

O **`sessionStorage`** funciona de forma id√™ntica ao `localStorage`, mas os dados duram apenas enquanto a aba estiver aberta.

  * **Persist√™ncia:** Apenas durante a sess√£o da aba.
  * **Escopo:** Isolado por aba. Outra aba do mesmo site n√£o ver√° os dados.
  * **Capacidade:** \~5-10MB.
  * **Dados:** Apenas `strings`.
  * **API:** **S√≠ncrona**.

**Ideal para:** Dados de formul√°rios, estado tempor√°rio de uma aplica√ß√£o.

-----

## `sessionStorage`: Exemplos de C√≥digo

```javascript
// Salva o progresso de um formul√°rio
const campoForm = document.getElementById('meuInput');
campoForm.addEventListener('keyup', () => {
  sessionStorage.setItem('progressoForm', campoForm.value);
});

// Restaura o valor ao recarregar a p√°gina
window.addEventListener('load', () => {
  const progresso = sessionStorage.getItem('progressoForm');
  if (progresso) {
    campoForm.value = progresso;
  }
});
```

-----

## **IndexedDB**

### O Banco de Dados no Navegador

-----

## `IndexedDB`

Um banco de dados NoSQL completo e transacional no navegador.

  * **Capacidade:** Gigabytes (depende do disco e permiss√£o).
  * **Dados:** Quase tudo (Objetos, Arrays, Arquivos/Blobs).
  * **API:** **Ass√≠ncrona** (n√£o bloqueia a interface, mas √© mais complexa).
  * **Estrutura:** Permite criar m√∫ltiplos bancos, *object stores* (tabelas) e *√≠ndices* para consultas r√°pidas.

**Ideal para:** Aplica√ß√µes offline (PWAs), manipula√ß√£o de grandes volumes de dados, consultas complexas.

-----

## `IndexedDB`: Exemplo de C√≥digo (Conceitual)

A API nativa √© verbosa. Bibliotecas como `Dexie.js` ou `idb` simplificam muito\!

**Fluxo B√°sico (Nativo):**

1.  **Abrir Conex√£o:** `indexedDB.open('MeuBanco', 1);`
2.  **Criar Schema:** No evento `onupgradeneeded`, criar *object stores* e √≠ndices.
3.  **Criar Transa√ß√£o:** `db.transaction('clientes', 'readwrite');`
4.  **Acessar Object Store:** `transaction.objectStore('clientes');`
5.  **Executar Opera√ß√£o:** `.add(novoCliente)`, `.get(1)`, `.getAll()`, `.delete(1)`.
6.  **Ouvir Eventos:** `onsuccess` e `onerror` para cada opera√ß√£o.

-----

## Tabela Comparativa

| Caracter√≠stica | `localStorage` | `sessionStorage` | `IndexedDB` |
| :--- | :---: | :---: | :---: |
| **Persist√™ncia** | Permanente | Por Sess√£o (Aba) | Permanente |
| **Capacidade** | \~5-10 MB | \~5-10 MB | **Grande** (GBs) |
| **Tipo de Dados** | Strings | Strings | **Objetos, Blobs...** |
| **API** | S√≠ncrona | S√≠ncrona | **Ass√≠ncrona** |
| **Escopo** | Por Origem | Por Aba | Por Origem |
| **Performance** | Bloqueante | Bloqueante | **N√£o Bloqueante** |
| **Complexidade** | **Baixa** | **Baixa** | Alta |

-----

## Melhores Pr√°ticas e Conclus√£o

-----

## Seguran√ßa e Melhores Pr√°ticas

  * üîí **N√ÉO armazene dados sens√≠veis\!** O armazenamento no cliente (especialmente Web Storage) √© vulner√°vel a ataques XSS (Cross-Site Scripting). N√£o guarde senhas, tokens de alta criticidade ou informa√ß√µes pessoais.

  * üîÑ **Sempre serialize/desserialize** objetos para `localStorage` e `sessionStorage` usando `JSON`.

  * üì¶ Para `IndexedDB`, considere usar **bibliotecas de abstra√ß√£o** como `Dexie.js` para simplificar o desenvolvimento.

  * üóëÔ∏è **Gerencie o espa√ßo:** Forne√ßa mecanismos para limpar dados, especialmente em aplica√ß√µes que usam muito IndexedDB.

-----

## Qual usar?

  * **`localStorage`**: Para dados pequenos e persistentes que o usu√°rio espera encontrar na pr√≥xima visita.

      * *Ex: Tema do site, idioma preferido.*

  * **`sessionStorage`**: Para dados tempor√°rios de uma √∫nica tarefa ou sess√£o.

      * *Ex: Dados de um formul√°rio de v√°rias etapas.*

  * **`IndexedDB`**: Para tudo que √© grande, complexo ou precisa funcionar offline.

      * *Ex: Um cliente de e-mail, um editor de documentos, dados de um PWA.*

-----

# Perguntas?
